<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.3.0"
           xmlns:ext="http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.5.0"
           xsi:schemaLocation="
		http://www.osgi.org/xmlns/blueprint/v1.0.0
		hteventIpcManagerImpltps://osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd

		http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.3.0
		http://aries.apache.org/schemas/blueprint-cm/blueprint-cm-1.3.0.xsd

		http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.5.0
		http://aries.apache.org/schemas/blueprint-ext/blueprint-ext-1.5.xsd">


    <!-- service import (interface) -->
    <reference id="assetRecordDao" interface="org.opennms.netmgt.dao.api.AssetRecordDao" />
    <reference id="hwEntityDao" interface="org.opennms.netmgt.dao.api.HwEntityDao" />
    <reference id="monitoringSystemDao" interface="org.opennms.netmgt.dao.api.MonitoringSystemDao" />
    <reference id="sessionUtils" interface="org.opennms.netmgt.dao.api.SessionUtils" />
    <reference id="ipInterfaceDao" interface="org.opennms.netmgt.dao.api.IpInterfaceDao" />
    <reference id="distPollerDao" interface="org.opennms.netmgt.dao.api.DistPollerDao" />
    <reference id="nodeDao" interface="org.opennms.netmgt.dao.api.NodeDao" />
    <reference id="serviceTypeDao" interface="org.opennms.netmgt.dao.api.ServiceTypeDao" />
    <reference id="eventDao" interface="org.opennms.netmgt.dao.api.EventDao" />


    <bean id="eventUtil" class="org.opennms.netmgt.eventd.EventUtilDaoImpl">
        <argument ref="eventdMetricRegistry" />
        <property name="nodeDao" ref="nodeDao" />
        <property name="assetRecordDao" ref="assetRecordDao" />
        <property name="ipInterfaceDao" ref="ipInterfaceDao" />
        <property name="hwEntityDao" ref="hwEntityDao" />
    </bean>


    <bean id="eventConfDao" class="org.opennms.netmgt.config.DefaultEventConfDao" init-method="afterPropertiesSet">
        <property name="configResource" value="file:/Users/markcbordelon/Documents/clodovicus/opennms/opennms/target/opennms-29.0.0-SNAPSHOT/etc
/eventconf.xml"/> <!-- TODO  ref=eventConfResourceLocation-->
    </bean>

    <bean id="eventExpander" class="org.opennms.netmgt.eventd.EventExpander">
        <argument ref="eventdMetricRegistry"/>
        <property name="eventConfDao" ref="eventConfDao"/>
        <property name="eventUtil" ref="eventUtil"/>
    </bean>



    <bean id="eventWriter" class="org.opennms.netmgt.eventd.processor.HibernateEventWriter">
        <property name="nodeDao" ref="nodeDao" />
        <property name="eventUtil" ref="eventUtil" />
        <property name="distPollerDao" ref="distPollerDao" />
        <property name="eventDao" ref="eventDao" />
        <property name="monitoringSystemDao" ref="monitoringSystemDao" />
        <property name="serviceTypeDao" ref="serviceTypeDao" />
        <property name="sessionUtils" ref="sessionUtils" />
    </bean>



    <bean id="eventdMetricRegistry" class="com.codahale.metrics.MetricRegistry" />

    <bean id="eventIpcBroadcastProcessor" class="org.opennms.netmgt.eventd.processor.EventIpcBroadcastProcessor">
        <argument ref="eventdMetricRegistry"/>
        <property name="eventIpcBroadcaster" ref="eventIpcManagerImpl"/>
    </bean>

    <bean id="eventdConfigManager" class="org.opennms.netmgt.config.EventdConfigManager"/>
    <bean id="shouldLogEventSummaries" factory-ref="eventdConfigManager" factory-method="shouldLogEventSummaries"/>
    <bean id="eventdEventHandler" class="org.opennms.netmgt.eventd.DefaultEventHandlerImpl">
        <argument ref="eventdMetricRegistry"/>
        <property name="eventProcessors">
            <list>
                <!--
                  This EventProcessor can be used to perform regex replacements on incoming parm values.
                  It was added in 1.11 and because of performance concerns, it is commented-out for now.
                -->
                <!-- <ref bean="eventParmRegexFilter"/> -->
                <ref component-id="eventExpander"/>
                <ref component-id="eventWriter"/> <!--HibernateEventWriter -->
                <ref component-id="eventIpcBroadcastProcessor"/>
            </list>
        </property>
        <property name="logEventSummaries" ref="shouldLogEventSummaries" />
        <property name="nodeDao" ref="nodeDao" />
    </bean>

    <bean id="eventIpcManagerImpl" class="org.opennms.netmgt.eventd.EventIpcManagerDefaultImpl">
        <argument ref="eventdMetricRegistry"/>
        <property name="handlerPoolSize" value="1000"/> <!-- TODO ref="eventIpcManagerHandlerPoolSize"-->
        <property name="handlerQueueLength" value="1000"/> <!-- TODO ref="eventIpcManagerHandlerQueueLength"-->
        <property name="eventHandler" ref="eventdEventHandler"/>
    </bean>

    <service ref="eventIpcManagerImpl" interface="org.opennms.netmgt.events.api.EventForwarder">
    </service>

</blueprint>