<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.3.0"
	       xsi:schemaLocation="
                http://www.osgi.org/xmlns/blueprint/v1.0.0
                https://osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
                
                http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.3.0
                http://aries.apache.org/schemas/blueprint-cm/blueprint-cm-1.3.0.xsd
">

  <cm:property-placeholder persistent-id="org.opennms.features.subscriptionchecker" update-strategy="reload">
    <cm:default-properties>
      <cm:property name="org.opennms.subscription.enabled" value="${subscriptionCheckEnabled}" />
      <cm:property name="org.opennms.subscription.groupid" value="${subscriptionGroupId}" />
      <cm:property name="org.opennms.subscription.artifactid" value="${subscriptionName}" />
      <cm:property name="org.opennms.subscription.version" value="${subscriptionVersion}" />
      <cm:property name="org.opennms.subscription.usermessage" 
        value="Your Meridian Subscription has expired or has not been installed. Ask your administrator to update the subscription." />
      <cm:property name="org.opennms.subscription.adminmessage"
        value="Your Meridian Subscription has expired or has not been installed. If your subscription expires you can continue to use your current Meridian instance but you will not receive updates. Further more, OpenNMS support services will not be applicable to this instance. To update your subscription please go to  &lt;a target=&quot;_blank&quot; href=&quot;https://opennms.com&quot; &gt; OpenNMS Support &lt;/a&gt; " />
    </cm:default-properties>
  </cm:property-placeholder>

  <reference id="licenceService" interface="org.opennms.karaf.licencemgr.LicenceService" availability="mandatory" />

  <!-- The model stores properties from the configuration file -->
  <bean id="model" class="org.opennms.features.subscriptionchecker.internal.Model" init-method="init" >
    <property name="enabled" value="${org.opennms.subscription.enabled}" />
    <property name="subscriptionGroupId" value="${org.opennms.subscription.groupid}" />
    <property name="subscriptionArtifactId" value="${org.opennms.subscription.artifactid}" />
    <property name="subscriptionVersion" value="${org.opennms.subscription.version}" />
    <property name="userMessage" value="${org.opennms.subscription.usermessage}" />
    <property name="adminMessage" value="${org.opennms.subscription.adminmessage}" />
  </bean>

  <bean id="modalInjector" class="org.opennms.features.subscriptionchecker.web.internal.ModalInjector">
    <property name="model" ref="model" />
  </bean>
  <service interface="org.opennms.web.api.HtmlInjector" ref="modalInjector">
    <service-properties>
      <entry key="registration.export" value="true" />
    </service-properties>
  </service>

</blueprint>