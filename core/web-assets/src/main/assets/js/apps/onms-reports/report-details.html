<form name="reportForm" class="form mx-4 mt-2" role="form" novalidate>
    <div class="" ng-if="report.parameters && report.parameters.length > 0">
        <h3 class="">Report Parameters</h3>
        <div ng-show="report.isGrafanaReport()" class="form-group">
            <label>Grafana Endpoint</label>
            <a ng-if="endpoints.length > 0" href="/opennms/admin/endpoint/index.jsp" title="Configure Grafana Endpoints"> <i class="fa fa-plug"></i></a>
            <a ng-if="endpoints.length == 0" href title="Reload Grafana Endpoints" ng-click="loadEndpoints()"> <i class="fa fa-refresh"></i></a>
            <select class="form-control custom-select"
                    ng-model="selected.endpoint"
                    ng-show="endpoints.length > 0"
                    ng-change="endpointChanged()"
                    ng-options="endpoint as endpoint.label for endpoint in endpoints"
            >
            </select>
            <p class="alert alert-warning" ng-if="endpoints.length == 0">
                There is no Grafana Endpoint defined.
                Please <a href="/opennms/admin/endpoint/index.jsp">add a Grafana Endpoint</a>.
            </p>
        </div>
        <div ng-show="report.isGrafanaReport() && selected.endpoint" class="form-group">
            <label>Grafana Dashboard</label>
            <a ng-if="dashboards.length > 0" href="{{selected.endpoint.url}}/{{selected.dashboard.url}}" title="Show Dasbhoard" target="_blank"> <i class="fa fa-dashboard"></i></a>
            <a ng-if="dashboards.length == 0" href title="Refresh Dashboards" ng-click="endpointChanged()"><i class="fa fa-refresh"></i></a>
            <select class="form-control custom-select"
                    ng-model="selected.dashboard"
                    ng-show="dashboards.length > 0"
                    ng-options="dashboard as dashboard.title for dashboard in dashboards">
            </select>
            <p class="alert alert-warning" ng-if="dashboards.length == 0">
                There is no Grafana Dashboard defined.
                Please <a href="{{selected.endpoint.url}}/dashboards" target="_blank">add a Dashboard</a>.
            </p>
        </div>

        <div ng-if="parameter.type === 'string' && parameter.hidden === false" class="form-group" ng-repeat-start="parameter in report.parameters">
            <label for="{{parameter.name}}" class="">{{parameter.displayName}}</label>

            <!--String -->
            <select id="{{parameter.name}}"
                    name="p{{parameter.name}}"
                    ng-if="parameter.inputType === 'reportCategorySelector'"
                    class="form-control custom-select"
                    ng-class="{ 'is-invalid' : reportForm['p' + parameter.name].$invalid || error[parameter.name]}"
                    ng-model="parameter.value"
                    ng-options="option for option in report.supportedSurveillanceCategories">
            </select>

            <select id="{{parameter.name}}" ng-if="parameter.inputType === 'onmsCategorySelector'" class="form-control custom-select" ng-model="parameter.value">
                <option ng-repeat="option in report.supportedCategories">{{option}}</option>
            </select>
            <input id="{{parameter.name}}"
                   ng-if="parameter.inputType !== 'reportCategorySelector' && parameter.inputType !== 'onmsCategorySelector'"
                   class="form-control" type="text" ng-model="parameter.value"/>
        </div>
        <!-- INT -->
        <div  ng-if="parameter.type === 'integer'" class="form-group">
            <label for="{{parameter.name}}" class="">{{parameter.displayName}}</label>
            <input id="{{parameter.name}}" class="form-control" type="text" ng-model="parameter.value"/>
        </div>
        <!-- FLOAT -->
        <div ng-if="parameter.type === 'float'" class="form-group">
            <label for="{{parameter.name}}" class="">{{parameter.displayName}}</label>
            <input id="{{parameter.name}}" class="form-control" type="text" ng-model="parameter.value"/>
        </div>
        <!-- DOUBLE -->
        <div ng-if="parameter.type === 'double'" class="form-group">
            <label for="{{parameter.name}}" class="">{{parameter.displayName}}</label>
            <input id="{{parameter.name}}" class="form-control" type="text" ng-model="parameter.value"/>
        </div>
        <!-- DATE -->
        <div ng-if="parameter.type === 'date'" class="form-group" ng-repeat-end>
            <label for="{{parameter.name}}" class="">{{parameter.displayName}}</label>
            <div class="input-group" ng-if="options.scheduleReport && parameter.useAbsoluteDate === false">
                <input type="number" min="0" max="31" class="form-control" ng-model="parameter.count" />
                <select class="form-control custom-select" ng-model="parameter.interval">
                    <option value="day">day</option>
                    <option value="month">month</option>
                    <option value="year">year</option>
                </select>
                <label class="my-auto mx-2"> ago, at </label>
                <input class="form-control" type="number" min="0" max="23" ng-model="parameter.hours" />
                <input class="form-control" type="number" min="0" max="59" ng-model="parameter.minutes" />
            </div>
            <datetimepicker ng-if="!options.scheduleReport || parameter.useAbsoluteDate === true"
                            locale="parameter.internalLocale"
                            format="parameter.internalFormat"
                            ng-model="parameter.internalValue"
                            expand="true"
            ></datetimepicker>
        </div>
        <hr class="mb-4"/>
    </div>

    <!-- FORMAT -->
    <div class="form-group" ng-if="options.showReportFormatOptions && !options.deliverReport">
        <label for="reportFormat" class="">Report Format</label>
        <select id="reportFormat"
                name="reportFormat"
                class="form-control custom-select"
                ng-model="report.format"
                ng-options="format as format for format in report.supportedFormats">
        </select>
        <hr class="mb-4"/>
    </div>

    <!--    <div class="form-group ml-4" ng-if="userInfo.isReportDesigner() || userInfo.isAdmin()">-->
    <!-- TODO MVR this is shown if the user isReportDesigner() || isAdmin() -->
    <!-- TODO MVR this is shown when in edit mode, but then the toggle is not untogglable -->
    <div class="form-group ml-4" ng-if="options.showDeliveryOptions && options.showDeliveryOptionsToggle">
        <input type="checkbox" id="deliverReport" ng-model="options.deliverReport" class="form-check-input" ng-change="options.scheduleReport = options.deliverReport && options.scheduleReport" />
        <label class="form-check-label"
               data-toggle="tooltip"
               data-placement="right"
               title="Deliver report to file system or via e-mail"
               for="deliverReport" >
            <i class="fa fa-share"></i> Deliver this report
        </label>
    </div>
    <div class="" ng-if="options.showDeliveryOptions && options.deliverReport">
        <h3>Report Delivery Options</h3>
        <div class="">
            <div class="form-group">
                <label for="instanceId">Unique name</label>
                <!-- TODO MVR tooltip? -->
                <input ng-disabled="!options.canEditTriggerName" id="instanceId" ng-model="report.deliveryOptions.instanceId" class="form-control" data-toggle="tooltip" data-placement="right" title="A name to identify this report. Must be unique overall reports."/>
            </div>
            <div class="form-group">
                <label for="format" class="">Format</label>
                <!-- TODO MVR tooltip? -->
                <select id="format"
                        name="format"
                        class="form-control custom-select"
                        ng-model="report.format"
                        data-toggle="tooltip"
                        data-placement="right"
                        title="The output format of the generated report."
                        ng-options="format as format for format in report.supportedFormats">
                </select>
            </div>
            <div class="form-group ml-4">
                <input type="checkbox" id="persistToggle" ng-model="report.deliveryOptions.persist" class="form-check-input"/>
                <!-- TODO MVR tooltip? -->
                <label class="form-check-label"
                       data-toggle="tooltip"
                       data-placement="right"
                       title="Indicates whether a copy of the generated report is stored on disk."
                       for="persistToggle" >
                    Save a copy of this report
                </label>
            </div>
            <div class="form-group ml-4">
                <input type="checkbox" id="sendMailToggle" ng-model="report.deliveryOptions.sendMail" class="form-check-input"/>
                <!-- TODO MVR tooltip? -->
                <label class="form-check-label" for="sendMailToggle" data-toggle="tooltip" data-placement="right" title="Indicates whether the generated report is send via email to the defined recipient.">
                    Email report
                </label>
            </div>

            <div class="form-group" ng-if="report.deliveryOptions.sendMail">
                <!-- TODO MVR tooltip? -->
                <label for="mailRecipient">Recipient</label>
                <input id="mailRecipient"
                       name="mailRecipient"
                       ng-model="report.deliveryOptions.mailTo"
                       placeholder="some@email.org"
                       type="email"
                       class="form-control"
                       ng-class="{ 'is-invalid' : reportForm.mailRecipient.$invalid }"
                       data-toggle="tooltip"
                       data-placement="right"
                       title="The recipient of the generated report if 'Email report' is enabled."
                       required />
                <div ng-show="reportForm.mailRecipient.$invalid" class="invalid-feedback">Please provide a valid email.</div>
            </div>
        </div>
        <hr class="mb-4"/>
    </div>

    <!--    <div class="form-group ml-4" ng-if="userInfo.isReportDesigner() || userInfo.isAdmin()">-->
    <div class="form-group ml-4" ng-if="options.showScheduleOptions && options.showScheduleOptionsToggle">
        <input type="checkbox" id="createSchedule" ng-model="options.scheduleReport" class="form-check-input" ng-change="options.deliverReport = options.deliverReport || options.scheduleReport" />
        <label class="form-check-label"
               data-toggle="tooltip"
               data-placement="right"
               title="Schedule this report"
               for="createSchedule" >
            <i class="fa fa-clock-o"></i> Schedule this report
        </label>
    </div>
    <div class="" ng-if="options.showScheduleOptions && options.scheduleReport">
        <h3>Schedule Editor</h3>
        <div class="">
            <onms-schedule-editor ng-model="report.scheduleOptions" />
        </div>
        <hr />
    </div>

    <div class="alert alert-warning" ng-if="report.isGrafanaReport() && !isGrafanaReady()">
        Please select a Grafana Endpoint and Grafana Dashboard in order to continue.
    </div>
</form>